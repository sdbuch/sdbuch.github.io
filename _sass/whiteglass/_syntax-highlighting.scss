/**
 * Syntax highlighting styles - Enhanced for Python
 */
.highlight {
  background-color: #f8f8f8;
  @extend %vertical-rhythm;

  .highlighter-rouge & {
    background-color: #f8f8f8;
  }
}

// Inline code styling
code.highlighter-rouge {
  background-color: #f6f8fa;
  border-radius: 3px;
  padding: 0.2em 0.4em;
  font-size: 85%;
  color: #24292e;
  font-weight: 500;
}

.highlight {
  
  // Comments - softer gray, italic
  .cm    { color: #6a737d; font-style: italic } // Comment.Multiline
  .cp    { color: #6a737d; font-weight: bold } // Comment.Preproc  
  .c1    { color: #6a737d; font-style: italic } // Comment.Single
  .cs    { color: #6a737d; font-weight: bold; font-style: italic } // Comment.Special
  .c, .cd { color: #6a737d; font-style: italic } // Comment, Comment.Doc
  
  // Errors
  .err   { color: #d73a49; background-color: #ffeef0 } // Error
  
  // Generic elements
  .gd    { color: #d73a49; background-color: #ffeef0 } // Generic.Deleted
  .ge    { font-style: italic } // Generic.Emph
  .gr    { color: #d73a49 } // Generic.Error
  .gh    { color: #6a737d; font-weight: bold } // Generic.Heading
  .gi    { color: #28a745; background-color: #f0fff4 } // Generic.Inserted
  .go    { color: #6a737d } // Generic.Output
  .gp    { color: #586069 } // Generic.Prompt
  .gs    { font-weight: bold } // Generic.Strong
  .gu    { color: #6a737d } // Generic.Subheading
  .gt    { color: #d73a49 } // Generic.Traceback
  
  // Keywords - Python blue
  .kc    { color: #005cc5; font-weight: bold } // Keyword.Constant (True, False, None)
  .kd    { color: #d73a49; font-weight: bold } // Keyword.Declaration (def, class)
  .kn    { color: #d73a49; font-weight: bold } // Keyword.Namespace (import, from)
  .kp    { color: #005cc5; font-weight: bold } // Keyword.Pseudo
  .kr    { color: #d73a49; font-weight: bold } // Keyword.Reserved (return, if, for, etc.)
  .kt    { color: #6f42c1; font-weight: bold } // Keyword.Type
  .k, .kv { color: #d73a49; font-weight: bold } // Keyword, Keyword.Variable
  
  // Numbers - teal
  .mf    { color: #005cc5 } // Literal.Number.Float
  .mh    { color: #005cc5 } // Literal.Number.Hex  
  .il    { color: #005cc5 } // Literal.Number.Integer.Long
  .mi    { color: #005cc5 } // Literal.Number.Integer
  .mo    { color: #005cc5 } // Literal.Number.Oct
  .m, .mb, .mx { color: #005cc5 } // Literal.Number
  
  // Strings - green
  .sb    { color: #032f62 } // Literal.String.Backtick
  .sc    { color: #032f62 } // Literal.String.Char
  .sd    { color: #6a737d; font-style: italic } // Literal.String.Doc (docstrings)
  .s2    { color: #032f62 } // Literal.String.Double
  .se    { color: #e36209 } // Literal.String.Escape
  .sh    { color: #032f62 } // Literal.String.Heredoc
  .si    { color: #e36209 } // Literal.String.Interpol (f-string expressions)
  .sx    { color: #032f62 } // Literal.String.Other
  .sr    { color: #22863a } // Literal.String.Regex
  .s1    { color: #032f62 } // Literal.String.Single
  .ss    { color: #6f42c1 } // Literal.String.Symbol
  .s     { color: #032f62 } // Literal.String
  
  // Names and identifiers
  .na    { color: #6f42c1 } // Name.Attribute
  .bp    { color: #005cc5 } // Name.Builtin.Pseudo (self, cls)
  .nb    { color: #005cc5 } // Name.Builtin (len, print, etc.)
  .nc    { color: #6f42c1; font-weight: bold } // Name.Class
  .no    { color: #005cc5 } // Name.Constant
  .nd    { color: #6f42c1; font-weight: bold } // Name.Decorator (@decorator)
  .ni    { color: #6f42c1 } // Name.Entity
  .ne    { color: #d73a49; font-weight: bold } // Name.Exception
  .nf    { color: #6f42c1; font-weight: bold } // Name.Function
  .nl    { color: #d73a49; font-weight: bold } // Name.Label
  .nn    { color: #6f42c1 } // Name.Namespace (module names)
  .nt    { color: #22863a } // Name.Tag
  .vc    { color: #24292e } // Name.Variable.Class
  .vg    { color: #24292e } // Name.Variable.Global
  .vi    { color: #24292e } // Name.Variable.Instance
  .nv    { color: #24292e } // Name.Variable
  
  // Operators
  .ow    { color: #d73a49; font-weight: bold } // Operator.Word (and, or, not, in, is)
  .o     { color: #d73a49 } // Operator
  .w     { color: #6a737d } // Text.Whitespace
}

/**
 * Littlefoot and citation popup styles
 */
.littlefoot__button {
  background-color: #f6f8fa !important;
  border: 1px solid #d1d5da !important;
  border-radius: 3px !important;
  color: #586069 !important;
  cursor: pointer;
  font-family: "Open Sans", sans-serif !important;
  font-size: 10px !important;
  font-weight: 500 !important;
  line-height: 1 !important;
  padding: 1px 4px !important;
  text-decoration: none !important;
  transition: all 0.15s ease;
  vertical-align: super !important;
  position: relative !important;
  top: -0.25em !important;
  
  &:hover, &:focus {
    background-color: #f1f3f4 !important;
    border-color: #c6cbd1 !important;
    color: #24292e !important;
  }
  
  &.is-active {
    background-color: #0366d6 !important;
    border-color: #0366d6 !important;
    color: white !important;
  }
}

// Override all Littlefoot styles with high specificity, but exclude MathJax and code elements
.littlefoot__popover,
.littlefoot__popover *:not(.MathJax):not([class*="mjx"]):not(mjx-container):not(mjx-math):not(code):not(.highlight):not(pre),
.citation-popup,
.citation-popup *:not(.MathJax):not([class*="mjx"]):not(mjx-container):not(mjx-math):not(code):not(.highlight):not(pre) {
  font-family: "Open Sans", sans-serif !important;
}

.littlefoot__popover, .citation-popup {
  background-color: white !important;
  border: 1px solid #d1d5da !important;
  border-radius: 6px !important;
  box-shadow: 0 8px 24px rgba(149, 157, 165, 0.2) !important;
  font-family: "Open Sans", sans-serif !important;
  font-size: 14px !important;
  font-weight: 400 !important;
  line-height: 1.5 !important;
  max-width: 350px !important;
  padding: 0 !important;
  z-index: 1000 !important;
  
  .littlefoot__content, .citation-content {
    padding: 12px 16px !important;
    font-family: inherit !important;
    
    p {
      margin: 0 0 8px 0 !important;
      font-family: inherit !important;
      
      &:last-child {
        margin-bottom: 0 !important;
      }
    }
    
    // Style bibliography entries in popups
    .title {
      font-weight: 600 !important;
      color: #24292e !important;
      font-family: inherit !important;
    }
    
    .author {
      color: #586069 !important;
      font-family: inherit !important;
    }
    
    // Clean up jekyll-scholar formatting in popups
    a {
      color: #0366d6 !important;
      text-decoration: none !important;
      font-family: inherit !important;
      
      &:hover {
        text-decoration: underline !important;
      }
    }
  }
}

// Custom styling for citation links to distinguish them
a[href^="#"]:not(.footnote):not(.reversefootnote) {
  color: #0366d6;
  text-decoration: none;
  border-bottom: 1px dotted #0366d6;
  
  &:hover {
    border-bottom-style: solid;
  }
}

// Fix MathJax rendering in footnote popups
.littlefoot__popover, .citation-popup {
  // Ensure MathJax uses proper math fonts, not inheriting text fonts
  .MathJax {
    font-family: "MathJax_Main", "Times New Roman", serif !important;
  }
  
  .MathJax_Display {
    margin: 0.5em 0 !important;
  }
  
  // Fix MathJax inline math styling
  .MathJax[role="math"] {
    display: inline !important;
  }
  
  // Override any font inheritance that might affect math
  mjx-container[jax="CHTML"] {
    font-family: "MathJax_Main", "Times New Roman", serif !important;
    line-height: normal !important;
  }
  
  mjx-math {
    font-family: "MathJax_Main", "Times New Roman", serif !important;
  }
  
  // Modern MathJax v3 selectors
  mjx-container {
    font-family: "MathJax_Main", "Times New Roman", serif !important;
    
    mjx-math {
      font-family: inherit !important;
    }
  }
  
  // Fix monospace code rendering in footnote popups
  code, tt {
    font-family: "SFMono-Regular", Consolas, "Liberation Mono", Menlo, Courier, monospace !important;
    background-color: #f6f8fa !important;
    border-radius: 3px !important;
    padding: 0.2em 0.4em !important;
    font-size: 85% !important;
    color: #24292e !important;
    font-weight: 500 !important;
  }
  
  pre {
    font-family: "SFMono-Regular", Consolas, "Liberation Mono", Menlo, Courier, monospace !important;
  }
  
  .highlight {
    font-family: "SFMono-Regular", Consolas, "Liberation Mono", Menlo, Courier, monospace !important;
  }
}
